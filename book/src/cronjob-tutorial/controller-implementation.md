# 实现一个控制器

我们的 CronJob 控制器的基本逻辑如下：

1. 加载指定名称的 CronJob

2. 列出所有处于活动状态的 Job，并更新状态

3. 根据历史保留上限清理旧的 Job

4. 检查是否已被暂停（若已暂停则不再执行其他操作）

5. 计算下一次计划运行时间

6. 如果符合计划且未超出截止时间，并且没有被并发策略阻塞，则运行一个新的 Job

7. 当我们发现有 Job 正在运行（自动完成）或到了下一次计划运行时间时，重新入队。

{{#literatego ./testdata/project/internal/controller/cronjob_controller.go}}

这部分内容不少，但现在我们已经有一个可工作的控制器了。接下来在集群上进行测试，如果没有问题，再将其部署！
